# 구매 요약 배너 구현 완료 요약

## ✅ 완료된 작업

### 1. 백엔드 API 구현

#### 📁 `backend/app/services/purchase_insights.py`
- **가중치 기반 점수 계산 로직**
  - 시간 가중치: 최근 구매일수록 높은 점수 (1주일: 1.5배, 1개월: 1.2배, 3개월: 1.0배)
  - 반복 구매 보너스: 같은 상품 여러 번 구매 시 점수 상승 (3회 이상: 1.5배, 6회 이상: 2.0배)
  - 수량 가중치: 구매 수량이 많을수록 높은 점수 (2-3개: 1.2배, 4개 이상: 1.5배)

- **인사이트 추출**
  - Top 3 상품 (가중치 점수 기준)
  - 반복 구매 상품 (3회 이상)
  - 최근 트렌드 (최근 1주일)
  - 카테고리 선호도

#### 📁 `backend/app/routers/users.py`
- `GET /api/users/{user_id}/purchase-summary` 엔드포인트
- 구매 요약 정보 반환 (구매 횟수, Top 상품, 반복 구매 등)

### 2. 프론트엔드 구현

#### 📁 `frontend/app/data/messageTemplates.ts`
- **랜덤 메시지 템플릿 시스템**
  - 유저별 5개 템플릿 (20대 여성, 30대 남성, 40대 여성)
  - 가중치 기반 랜덤 선택
  - 변수 치환 함수

#### 📁 `frontend/app/components/PurchaseSummaryBanner.tsx`
- API 호출 및 데이터 처리
- 메시지 템플릿 랜덤 선택
- 동적 변수 치환
- 로딩 상태 처리
- 구매 상품 칩 표시

## 🎯 핵심 로직

### 1. 구매 횟수 기반 점수화 (가중치 적용)

```
상품 점수 = 구매횟수 × 시간가중치 × 반복구매보너스 × 수량가중치
```

**예시:**
- 삼각김밥 모음을 최근 1주일 내 3번 구매, 수량 2개씩
- 점수 = 3 × 1.5 × 1.3 × 1.2 = **7.02점**

### 2. 고객에게 와닿는 인사이트

#### 구체적인 숫자
- "지난 한 달간 **6회** 구매하셨네요!"
- "삼각김밥 모음을 **3번**이나 주문하시는 걸 보니..."

#### 패턴 발견
- "자주 주문하시는 걸 보니..."
- "번갈아 주문하시는 걸 보니..."

#### 개인화된 피드백
- "요리 실력이 대단하시군요!"
- "가족 건강을 최우선으로 생각하시는군요!"

### 3. 랜덤 메시지 템플릿

#### 템플릿 예시 (김지은 - 20대 여성)
1. **간편함 강조**: "바쁜 일상 속에서도 꼼꼼하게 끼니를 챙기시는군요!"
2. **경제성 강조**: "가성비 좋은 상품을 잘 찾으시는군요!"
3. **편의성 강조**: "시간 절약을 중시하시는군요!"
4. **건강 고려**: "혼자서도 건강한 식단을 챙기시는군요!"
5. **패턴 발견**: "3번이나 주문하시는 걸 보니 정말 좋아하시는군요!"

#### 랜덤 선택 로직
- 가중치 기반 선택 (높은 가중치일수록 자주 선택됨)
- 매번 페이지 로드 시 다른 메시지 표시
- 지루함 방지 및 재방문 유도

## 📊 데이터 흐름

```
1. 사용자 프로필 확인 (ProfileContext)
   ↓
2. API 호출: GET /api/users/{user_id}/purchase-summary
   ↓
3. 백엔드: 구매이력 분석 및 가중치 계산
   ↓
4. 인사이트 추출 (Top 상품, 반복 구매 등)
   ↓
5. 프론트엔드: 메시지 템플릿 랜덤 선택
   ↓
6. 변수 치환 및 UI 렌더링
```

## 🔧 현재 상태

### 더미데이터 사용 중
- 실제 구매이력 데이터가 생성되면 API 연동 가능
- 현재는 유저별 하드코딩된 더미데이터 사용
- API 엔드포인트는 구현 완료 (주석 처리)

### 실제 API 연동 방법
```typescript
// PurchaseSummaryBanner.tsx에서 주석 해제
const response = await fetch(`http://localhost:8001/api/users/${mockUserId}/purchase-summary`);
const data = await response.json();
```

## 🎨 UX 개선 효과

### 1. 구체성
- ✅ 카테고리명 대신 실제 상품명 표시
- ✅ 구매 횟수, 반복 구매 등 구체적 숫자

### 2. 개인화
- ✅ 유저별 맞춤 메시지
- ✅ 라이프스타일 반영

### 3. 재미 요소
- ✅ 랜덤 메시지로 지루함 방지
- ✅ 다양한 톤의 메시지

### 4. 신뢰감
- ✅ 실제 구매 데이터 기반
- ✅ 패턴 분석 인사이트

## 📝 다음 단계

### 1. 실제 구매이력 데이터 생성 후
- [ ] API 연동 (주석 해제)
- [ ] 실제 데이터 기반 테스트

### 2. 추가 개선 사항
- [ ] 시간대별 메시지 (아침/점심/저녁)
- [ ] 요일별 메시지 (평일/주말)
- [ ] 구매 패턴 기반 동적 템플릿 선택

### 3. 성능 최적화
- [ ] 캐싱 (같은 유저는 일정 시간 동안 캐시)
- [ ] 로딩 상태 개선

## 🚀 사용 방법

### 백엔드 실행
```bash
cd backend
source .venv/bin/activate
uvicorn app.main:app --host 0.0.0.0 --port 8001 --reload
```

### 프론트엔드 실행
```bash
cd frontend
npm run dev
```

### API 테스트
```bash
curl http://localhost:8001/api/users/1/purchase-summary
```

## 📚 참고 문서

- `RECOMMENDATION_LOGIC_DESIGN.md`: 상세 설계 문서
- `DATABASE_SETUP_GUIDE.md`: 데이터베이스 설정 가이드
- `DEVELOPMENT_SPEC.md`: 개발 스펙 문서

